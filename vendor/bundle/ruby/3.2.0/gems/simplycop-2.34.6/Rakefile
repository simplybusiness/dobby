# frozen_string_literal: true

# rubocop:disable Rails/RakeEnvironment
require 'bundler/gem_tasks'
require 'rspec/core/rake_task'
require 'rubocop/rake_task'

# RSpec task for running tests
RSpec::Core::RakeTask.new(:spec) do |task|
  task.rspec_opts = '--format documentation --color'
end

# RuboCop task for linting
RuboCop::RakeTask.new(:rubocop) do |task|
  task.options = ['--display-cop-names', '--format', 'progress']
end

# Combined quality check task
desc 'Run all quality checks (tests + linting)'
task quality: [:spec, :rubocop]

# CI task (same as quality but with different name for CI systems)
desc 'Run all checks for CI (tests + linting)'
task ci: :quality

# Default task
task default: :quality

# Custom task to list all custom cops
desc 'List all custom cops with their descriptions'
task :list_custom_cops do
  puts "ğŸ“‹ Custom Cops in SimplyCop:\n\n"

  # Custom cops
  Dir.glob('lib/simplycop/custom_cops/*.rb').each do |file|
    cop_name = File.basename(file, '.rb')
    puts "ğŸ” CustomCops/#{cop_name.split('_').map(&:capitalize).join('')}"

    # Try to extract description from the file
    content = File.read(file)
    if /# @example\s*\n#\s*#bad\s*\n(.*?)#\s*#good/m.match?(content)
      puts "   Description: Found in #{file}"
    end
    puts
  end

  # Security cops
  Dir.glob('lib/simplycop/security/*.rb').each do |file|
    cop_name = File.basename(file, '.rb')
    puts "ğŸ”’ Security/#{cop_name.split('_').map(&:capitalize).join('')}"
    puts "   Description: Found in #{file}"
    puts
  end
end

# Development setup task
desc 'Setup development environment'
task :setup do
  puts 'ğŸ”§ Setting up development environment...'
  sh 'bundle install'
  puts 'âœ… Bundle installed'
  sh 'bundle exec rspec --version'
  puts 'âœ… RSpec ready'
  sh 'bundle exec rubocop --version'
  puts 'âœ… RuboCop ready'
  puts 'ğŸ‰ Development environment ready!'
end
# rubocop:enable Rails/RakeEnvironment
